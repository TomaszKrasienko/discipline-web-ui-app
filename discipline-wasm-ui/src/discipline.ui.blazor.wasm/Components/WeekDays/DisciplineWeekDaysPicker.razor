@using BlazorBootstrap
@using discipline.ui.infrastructure.Constants
<Collapse @ref="@_weekdaysCollapse">
    <Card>
        <CardBody Style="background-color: var(--dark); border-color: var(--dark)">
            @foreach (var weekDay in _weekDays)
            {
                <Button
                    style="background-color: var(--light)"
                    Active="@(_selected?.Contains(weekDay.Value) ?? false)"
                    @onclick="async () => await ChangeSelection(weekDay.Value)">
                    @weekDay.Name
                </Button>
            }
        </CardBody>
    </Card>
</Collapse>


@code {
    private Collapse _weekdaysCollapse = new();
    private readonly IEnumerable<WeekDay> _weekDays = WeekDay.List();
    private HashSet<int>? _selected;

    [Parameter, EditorRequired]
    public EventCallback<HashSet<int>?> OnSelectionChanged { get; set; }

    private async Task ChangeSelection(int value)
    {
        if (_selected is null)
        {
            _selected = [];
        }
        
        if (!_selected.Add(value))
        {
            _selected.Remove(value);
        }

        if (!_selected.Any())
        {
            _selected = null;
        }

        await OnSelectionChanged.InvokeAsync(_selected);
    }

    public async Task ShowToggle()
        => await _weekdaysCollapse.ShowAsync();

    public async Task HideToggle()
        => await _weekdaysCollapse.HideAsync();

}